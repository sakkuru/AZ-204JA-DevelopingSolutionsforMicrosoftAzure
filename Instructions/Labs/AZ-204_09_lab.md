---
lab:
    title: 'ラボ: Logic Apps を使用したビジネス プロセスの自動化'
    module: 'モジュール 09: App Service ロジック アプリの開発'
---
    
# ラボ: Logic Apps を使用してビジネス プロセスを自動化する
# 学生課題マニュアル

## ラボ シナリオ

組織では、Microsoft Azure のサーバー メッセージ ブロック (SMB) ファイル共有でサード パーティ製品を構成するために使用する JSON ファイルのコレクションを保持します。通常の監査の一環として、運用チームは、単純な HTTP エンドポイントを呼び出して、現在の構成ファイルの一覧を取得します。Azure API Management サービスと Logic Apps に基づくコードなしソリューションを使用して、この機能を実装することにしました。

## 目標

この課題を修了すると、次のことが可能になります:

-   ロジック アプリ ワークフローを作成します。

-   Logic App で製品と API を管理します。

-   Logic App 用のプロキシとして  Azure API Management を使用します。

## 課題の設定

-   推定時間: **45 分**

## 手順

### 開始する前に

#### ラボの仮想マシンへのログイン

次の認証情報を使用して、Windows 10 仮想マシン (VM) にサインインしていることを確認します。
    
-   ユーザー名: **管理者**

-   パスワード: **Pa55w.rd**

#### インストールされたアプリケーションのレビュー

Windows 10 デスクトップでタスク バーを探します。タスク バーには、この課題で使用するアプリケーションのアイコンが含まれています:

-   Microsoft Edge

-   ファイル Explorer

-   Windows ターミナル

### 演習 1: Azure のリソースを作成

#### タスク 1: Azure portal を開く

1.  Azure portal (<https://portal.azure.com>) にログインします。

1.  Azure portal に初めてログインする場合は、ポータルのツアーを提供するダイアログ ボックスが表示されます。ツアーをスキップするには、「**開始**」 を選択します。

#### タスク 2: API Management リソースの作成

1.  Azure portal で、次の詳細を使用して新しい API Management アカウントを作成します。

    -   新しいリソース グループ: **AutomatedWorkflow**

    -   名前: **prodapim*[yourname]***

    -   場所: **米国東部**

    -   組織名: **Contoso**

    -   価格レベル: **消費 (99.9% SLA)**

    > **注**: Azure の API Management resource の作成完了を待ってから、ラボを進めます。リソースの作成時に通知が届きます。

#### タスク 3: ロジック アプリ リソースの作成

1.  Azure portal で、以下の詳細を使用して新しい **ロジック アプリ** を作成します。
    
    -   既存のリソース グループ: **AutomatedWorkflow**

    -   名前: **prodflow*[yourname]***

    -   場所: **リージョン - 米国東部**

    -   Log Analytics: **オフ**

    > **注意**: Azure が Logic Apps resource の作成を完了するのを待ってから、ラボを進めます。リソースが作成されると通知を受け取ります。

#### タスク 4: ストレージ アカウントを作成する

1.  次の詳細で新規ストレージ アカウントを作成します:
    
    -   既存のリソース グループ: **AutomatedWorkflow**

    -   名前: **prodstor*[yourname]***

    -   場所: **(米国) 米国東部**

    -   パフォーマンス: **Standard**

    -   アカウント サブタイプ: **StorageV2 (general purpose v2)**

    -   レプリケーション: **ローカル冗長ストレージ (LRS)**

    -   アクセス レベル: **ホット**

    > **注意**: Azure がストレージ アカウントの作成を完了するのを待ってから、ラボを進みます。アカウントの作成時に通知が届きます。

#### タスク 5: サンプル コンテンツを Azure Files にアップロードする

1.  このラボで前に作成済みの **prodstor*[yourname]*** ストレージ アカウントにアクセスします。

1.  「**ファイル サービス**」 セクションの 「**ファイル共有**」 リンクを選択し、次の設定で新しい共有を作成します。
    
    - 名前: **metadata**

    - クォータ: **1** (GiB) 

1.  最近作成した**metadata**共有を選択します。 
    
1.  **metadata** 共有で、「**アップロード**」 を選択し、に次のファイルをアップロードします。ラボ VM 上の **Allfiles (F):\\Allfiles\\Labs\\09\\Starter** フォルダ。

    -   **item_00.json**
    
    -   **item_01.json**
    
    -   **item_02.json**
    
    -   **item_03.json**
    
    -   **item_04.json** 

    > **注**: **ファイルが既に存在する場合は上書きする** オプションを有効にすることをお勧めします。

#### レビュー

このラボでは、このラボで使用するすべてのリソースを作成しました。

### 演習 2: ロジック アプリを使用したワークフローの実装

#### タスク 1: ロジック アプリのワークフロー用トリガーの作成

1.  このラボで前に作成済みの **prodflow*[yourname]*** ロジック アプリにアクセスします。

1.  **Logic Apps デザイナー** ブレードで、 **空のロジック アプリ** テンプレートを選択します。

1.  **デザイナー** 領域で、 **HTTP 要求を受信したとき (要求)** トリガーを追加します。

    -   メソッド: **GET**

#### タスク 2: Azure Storage ファイル共有を照会するアクションを作成する

1.  「**デザイナー**」 領域に、次の詳細を含む新しい **リスト ファイル (Azure File Storage)** アクションを追加します。

    -   接続名: **filesConnection**

    -   ストレージ アカウント: **prodstor*[yourname]***
    
    -   フォルダー: **/metadata**
    
#### タスク 3: プロジェクト リスト項目のプロパティに対するアクションの作成

1.  **デザイナー** 領域に、次の詳細を含む新しい **選択 (データ操作)** アクションを追加します。

    -   開始: **value (List files)**

    -   マップ モード: **テキスト**

    -   マップ: **Name (List files)**

#### タスク 4: HTTP 応答アクションの構築

1.  **デザイナー** 領域で、次の詳細を含む新しい **応答 (要求)** アクションを追加します。
    
    -   状態コード: **200**
    
    -   本文: **出力 (Select)**

1.  ワークフローを **保存**します。

#### レビュー

この演習では、HTTP GET 要求によってトリガーされたときに開始される基本的なワークフローを作成しました。次に、ストレージ サービスを照会し、結果を列挙し、その結果を HTTP 応答として返します。

### エクササイズ 3: Azure API Management をロジック アプリのプロキシとして使用する

#### タスク 1: 新しいブランチを作成する

1.  この課題で先ほど作成した **prodapim*[yourname]*** API Management リソースにアクセスします。

1.  新しいアカウントの **製品** の空のリストに移動します。

    > **注**: 消費プランは、製品なしで開始します。

1.  次の詳細を含む新しい製品を追加します。

    -   表示名: **Free**

    -   Id: **free** 

    -   説明: **匿名使用の Free レベル**

    -   状態: **発行済み**

    -   サブスクリプションが必要: **無効**

#### タスク 2: Logic Apps と統合された API を作成する

1.  アカウントの **API** の空のリストに移動します。

1.  以下の詳細を含む新しい **Logic App** API を作成します。

    -   Logic App: prodflow[yourname]**

    -   Display name: Metadata Lookup

    -   Name: metadata-lookup

    -   Description: Look up metadata JSON files

    -   Products: Free

#### タスク 3: API 操作をテストする

1.  新しい API の 「**Test**」 タブに移動します。

1.  **Test** タブで、次の操作を実行します：

    1.  **GET** 操作を選択 します。

    1.  **Request URL** フィールドの値をコピーします。（これらの値は、この演習の後半で使用します）

    1.  操作に対してテスト要求を実行します。

    1.  テスト要求の JSON 結果を確認します。

#### タスク 4: httprepl を使用してエンドツーエンドのソリューションを検証する

1.  **Windows Terminal** アプリケーションを開きます。

1.  **httprepl** ツールを起動し、次の例を使用して、このラボで前にコピーした API 操作の **Request URL** の値 Uniform Resource Identifier (URI) を設定します。

    ```
    httprepl <api-operation-request-url>
    ```

    > **注**: たとえば **URL** が **https://prodapimstudent.azure-api.net/manual/paths/invoke** の場合 、コマンドは **httprepl https://prodapimstudent.azure-api.net/manual/paths/invoke** になります。

1.  ツールプロンプト内で、API エンドポイントに対して **get** コマンドを実行します。

    ```
    get
    ```

1.  関数アプリの応答の JSON 応答の内容を確認します。

1.  **httprepl** アプリケーションを終了する:

    ```
    exit
    ```

1.  現在実行中の Windows Terminal アプリケーションを閉じます。

1.	Azure portal 内のブラウザー ウィンドウに戻ります。

#### レビュー

この演習では、Azure API Management をプロキシとして使用して、ロジック アプリ のワークフローをトリガーしました。

### 演習 4: サブスクリプションのクリーンアップ

#### タスク 1: Azure Cloud Shell を開き、リソース グループを一覧表示する

1.  Azure potalの上部で、**Cloud Shell** アイコンを選択して新しいシェル インスタンスを開きます。

1.  Azure portal  の **Cloud Shell** コマンド プロンプトで、次のコマンドを入力してから、Enter を選択してサブスクリプション内のすべてのリソース グループを一覧表示します。

    ```
    az group list
    ```

1.  次のコマンドを入力し、Enter キーを押して、リソース グループを削除する可能性のあるコマンドの一覧を表示します。

    ```
    az group delete --help
    ```

#### タスク 2: リソース グループを削除する

1.  次のコマンドを入力し、Enter キーを押して **AutomatedWorkflow** リソース グループを削除します。

    ```
    az group delete --name AutomatedWorkflow --no-wait --yes
    ```

1.  Cloud Shell ウィンドウを閉じます。

#### タスク 3: アクティブなアプリケーションを閉じる

-   現在実行中の Microsoft Edge アプリケーションを閉じます。

#### レビュー

このエクササイズでは、このラボで使用されたリソース グループを削除して、サブスクリプションをクリーンアップしました。
