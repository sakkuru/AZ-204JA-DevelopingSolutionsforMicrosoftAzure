---
lab:
    title: 'ラボ: Logic Apps を使用したビジネス プロセスの自動化'
    module: 'モジュール 09: App Service ロジック アプリの開発'
    type: 'Answer Key'
---
    
# ラボ: Logic Apps を使用してビジネス プロセスを自動化する
# 学生課題解答キー

## Microsoft Azure ユーザー インターフェイス

Microsoft クラウド ツールのダイナミックな特性を考えると、このトレーニング コンテンツの開発後に Azure ユーザー インターフェイスの変更が発生する可能性があります。これらの変更により、ラボの指示と手順が一致しない場合があります。

Microsoft では、コミュニティから必要な変更要望を受けたときにトレーニング コースを更新します。ただし、クラウドの更新は頻繁に行われるため、トレーニング コンテンツの更新前に UI が変更される場合もあります。**その場合は、変更に適宜対応して、ラボで要求されている内容を処理してください。**

## 説明

### 開始する前に

#### 課題の仮想マシンへのログイン

次の認証情報を使用して、Windows 10 仮想マシン (VM) にログインします。
    
-   ユーザー名: **管理者**

-   パスワード: **Pa55w.rd**

> **注記**：仮想ラボ環境に接続する手順は講師が説明します。

#### インストールされたアプリケーションのレビュー

Windows 10 デスクトップでタスク バーを探します。タスク バーには、この課題で使用するアプリケーションのアイコンが含まれています:
    
-   Microsoft Edge

-   ファイル Explorer

-   Windows ターミナル

### 演習 1: Azure リソースを作成する

#### タスク 1: Azure portal を開く

1.  タスク バーで、**Microsoft Edge** アイコンを選択します。

1.  開いているブラウザー ウィンドウで、「Azure portal」(<https://portal.azure.com>)に移動します。

1.  Microsoft アカウントの電子メール アドレスを入力し、 「**次へ**」 を選択します。

1.  Microsoft アカウントのパスワードを入力し、「**サインイン**」 を選択します。

    > **注**: Azure portal に初めてログインする場合は、ポータルのツアーが表示されます。ツアーをスキップするには、**開始** を選択します。

#### タスク 2: API Management リソースの作成

1.  Azure potalのナビゲーション ペインで、**リソースの作成**を選択します。

1.  「**新規**」 ブレードで、「**Marketplace を検索**」 というテキスト ボックスを探します。

1.  検索ボックスで、「**API**」 を入力し、Enter を選択します。

1.  **Marketplace** 検索結果ブレードから、「**API 管理**」 を選択します。

1.  「**API 管理**」 ブレードで、「**作成**」 を選択します。

1.  **API Management サービス** ブレードで、次のアクションを実行します。
    
    1.  「**名前**」 ボックスに、**prodapim*[yourname]*** を入力します。
    
    1.  「**サブスクリプション**」 ボックスは既定値のままにします。
    
    1.  「**リソース グループ**」 セクションで、「**新規作成**」 を選択し、「**AutomatedWorkflow**」を入力し、「**OK**」 を選択します。
    
    1.  「**場所**」 リストで、「**米国東部**」 リージョンを選択します。
    
    1.  「**組織名**」 ボックスに、「**Contoso**」 を入力します。
    
    1.  「**管理者のメール アドレス**」ボックスは、既定値のままにしておきます。
    
    1.  「**価格レベル**」 ボックスで、**消費 (99.9 SLA %)** を選択し、「**作成**」を選択します。
    
    > **注**: Azure の API Management resource の作成完了を待ってから、ラボを進めます。リソースの作成が完了すると通知が届きます。

#### タスク 3: ロジック アプリ リソースの作成

1.  Azure portal のナビゲーション ペインにある 「**+リソースの作成**」を選択します。

1.  **新規**ブレードの 「**Marketplaceを検索**」 フィールドを使います。

1.  検索フィールドで、「**Logic**」 と入力し、Enter キーを押します。

1.  「**すべての** 検索結果] ブレードで、**Logic App** を選択します。

1.  **Logic App** ブレードで、「**作成**」 を選択します。

1.  「**ロジック アプリ**」 ブレードで、ブレードのタブ(「**基本**」、「**タグ**」、「**確認 + 作成**」 など) を確認します。

    > **注**: 各タブは、新しいロジック アプリを作成するためにワークフロー内のステップを表します。いつでも 「**確認および作成**」 を選択して、残りのタブをスキップできます。

1.  **基本** タブを選択し、タブ領域で次の操作を実行します。
       
    1.  **サブスクリプション** フィールドは既定値に設定したままにします。
    
    1.  **ストレージ グループ** セクションで、「**既存のものを使用**」を選択し、この実習ラボで前に作成した **AutomatedWorkflow** を指定します。
        
    1.  「**ロジック アプリ名**」 フィールドに **prodflow*[yourname]*** と入力します。

    1.  「**場所の選択**」 セクションで、「**地域**」 を選択します。

    1.  「**場所**」リストで、「**米国東部**」リージョンを選択します。
    
    1.  「**ログ分析**」 を、**オフ**にします。
    
    1.  「**確認および作成**」 を選択します。

1.  **確認および作成** タブで、以前の手順で指定したオプションを確認します。

1.  指定した構成を使用してロジック アプリを作成するために、「**作成**」 を選択します。

    > **注**: Azure が Logic Apps resource の作成を完了するのを待ってから、ラボを進めます。リソースの作成が完了すると通知が届きます。

#### タスク 4: ストレージ アカウントを作成する

1.  Azure portal で、**すべてのサービス** を選択します。

1.  「**すべてのサービス**」 ブレードで、「**ストレージ アカウント**」 を選択します。

1.  「**ストレージ アカウント**」 ブレードで、ストレージ アカウント インスタンスの一覧を取得し、「**追加**」 を選択します。

1.  「**ストレージ アカウントを作成**」 ブレードで、「**基本**」、「**タグ**」、「**レビュー + 作成**」 など、ブレードにあるタブをレビューします。

    > **注**: 各タブは、新しいストレージ アカウントを作成するための、ワークフロー内のステップを表しています。いつでも 「**確認および作成**」 を選択して、残りのタブをスキップできます。

1.  **基本** タブを選択し、タブ領域で次の操作を実行します。
    
    1.  「**サブスクリプション**」 テキスト ボックスを既定値のままにします。
    
    1.  「**リソース グループ**」 セクションで、ラボで前に作成した **AutomatedWorkflow** グループを選択します。
    
    1.  「**ストレージ アカウント名**」 テキスト ボックスに、**prodstor*[yourname]*** と入力します。
    
    1.  「**場所**」 リストで、「**(US) 米国東部**」 リージョンを選択します。
    
    1.  「**パフォーマンス**」 セクションで、「**標準**」 を選択します。
    
    1.  「**アカウントの種類**」 リストで、**StorageV2 (general purpose v2)** を選択します。
    
    1.  「**レプリケーション**」 リストで、**ローカル冗長ストレージ (LRS)** を選択します。
    
    1.  「**アクセス層 (既定)**」 セクションで、「**Hot**」 が選択されていることを確認します。
    
    1.  「**確認および作成**」 をクリックします。

1.  **確認および作成** タブで、以前の手順で指定したオプションを確認します。

1.  指定した構成を使用してストレージ アカウントを作成するには、**作成** を選択します。

    > **注**: 「**デプロイ**」 ブレードで、この課題を進める前に、作成タスクが完了するまで待ちます。

#### タスク 5: サンプル コンテンツを Azure Files にアップロードする

1.  Azure portal ナビゲーション ペインで、「**リソース グループ**」 を選択します。

1.  **リソース グループ** ブレードで、 この実習ラボで前に作成した **"AutomatedWorkflow"** リソース グループを見つけて選択します。

1.  **AutomatedWorkflow** ブレードで、 この実習ラボで前に作成した **prodstor*[yourname]*** ストレージ アカウントを選択します。

1.  **ストレージ アカウント** ブレードの **File サービス** セクションで 、**ファイル共有** リンクを選択します。

1.  **ファイル共有** セクションで、 **「＋ファイル共有」** を選択します。

1.  **新しいファイル共有** のポップアップ ダイアログボックスで、次の操作を実行します。
    
    1.  「**名前**」 テキストボックスに、「**metadata**」 を入力します。
    
    1.  「**クォータ**」 テキストボックスに、「**1**」(GiB) を入力します。
    
    1.  「**作成**」 を選択します。

1.  **ファイル共有** セクションに戻り、新しく作成した **metadata** を選択します。

1.	**ファイル共有** ブレードで、「**アップロード**」 を選択します。

1.	**ファイルのアップロード** ダイアログ ボックスで、次の手順を実行します。

    1.  **ファイル** セクションで、**フォルダ** アイコンを選択します。

    1.  **ファイル エクスプローラ** ウィンドウで、**すべてのファイル (F):\\Allfiles\\Labs\\09\\Starter** に移動し、以下のファイルを選択し、「**アップロード**」 を選択します。

        -   **item_00.json.**
        
        -   **item_01.json.**
        
        -   **item_02.json.**
        
        -   **item_03.json.**
        
        -   **item_04.json.** 

    1.  「**ファイルが既に存在する場合は上書きする**」 チェックボックスがオンにチェックされていることを確認し、 「**アップロード**」 を選択します。 
    
    > **注**: この演習を続行する前に、BLOB がアップロードされるのを待ちます。

#### レビュー

このラボでは、このラボで使用するすべてのリソースを作成しました。

### 演習 2: ロジック アプリを使用したワークフローの実装

#### タスク 1: ロジック アプリのワークフロー用トリガーの作成

1.  Azure portal の左側のナビゲーション ウィンドウで、**リソース グループ** を選択します。

1.  **リソース グループ** ブレードで、この実習ラボで前に作成した **AutomatedWorkflow** リソース グループを選択します。

1.  **AutomatedWorkflow** ブレードで、この実習ラボで前に作成した **prodflow*[yourname]*** ロジック アプリを選択します。

1.  **Logic Apps デザイナー** ブレードで、 **空のロジック アプリ** テンプレートを選択します。

1.  「**デザイナー**」 領域で、「**HTTP 要求の受信時 (要求)**」 トリガーを追加するために、次の手順を実行します。
    
    1.  「**コネクタとトリガーを検索**」 フィールドに、「**HTTP**」 を入力します。
    
    1.  カテゴリ リストで、「**要求**」 を選択します。
    
    1.  「**トリガー**」 一覧で、「**HTTP要求の受信時**」 を選択します。

1.  **HTTP 要求の受信時** のエリアで、以下の手順で **HTTP 要求の受信時 (Request)**  トリガーを定義します。   
    
    1.  **Add new parameter** リストで、**メソッド** を選択します。

    1.  **メソッド** リストで、 **GET** を選択します。

#### タスク 2: Azure Storage ファイル共有を照会するアクションを作成する

1.  「**デザイナー**」 エリアで、「**+ 新しいステップ**」 を選択し、以下の手順で **リスト ファイル (Azure File Storage)** アクションを追加します。
    
    1.  「**コネクタとアクションを検索する**」 フィールドに、「**ファイル**」 と入力します。
    
    1.  カテゴリ リストで、「**Azure File Storage**」 を選択します。
    
    1.  「**アクション**」 一覧で、「**リスト ファイル**」 を選択します。
    
    1.  **接続名** フィールドに、**filesConnection** を入力します。
    
    1.  **ストレージ アカウント** セクションで、 この実習ラボで前に作成した **prodstor*[yourname]*** ストレージ アカウントを選択し、「**作成**」 をクリックします。
    
    1.  コネクタ リソースの作成が完了するのを待ちます。

        **注意**: これらのリソースの作成には 1分 から 5 分かかります。

1.  「**リスト ファイル**」 エリアの 「**フォルダー**」 テキスト ボックスに、「**/metadata**」と入力します。
    
#### タスク 3: プロジェクト リスト項目のプロパティに対するアクションの作成

1.  「**デザイナー**」 領域で、「**+ 新しいステップ**」 を選択します。

1.  **デザイナー**領域で、以下の手順で **選択(データ操作)** のアクションを追加します。
    
    1.  **"コネクタとトリガーを検索する"** と表示されたフィールドに **データ操作** と入力します。
    
    1.  カテゴリ リストで、**データ操作** を選択します。
    
    1.  **アクション** 一覧で、**選択** を選択します。

1.  **選択** 領域で、次の手順で **選択 (データ操作)** アクションを定義します。
    
    1.  「**開始**」フィールドの 「**リストファイル**」 カテゴリの 「**動的なコンテンツ**」 リストで、「**value**」 を選択します。 
    
    1.  「**マップ**」 フィールドで、「**テキストモードに切り替える**」 を選択します。

    1.  「**[ップ**」 フィールドの 「**リスト ファイル**」 カテゴリの 「**動的コンテンツ**」 リストで、「**Name**」 を選択します。
    
#### タスク 4: HTTP 応答アクションの構築

1.  「**デザイナー**」 領域で、「**+ 新しいステップ**」 を選択してから、「**応答 (要求)**」アクションを追加するために以下のアクションを実行します。
 
    1.  「**コネクターとトリガーを検索**」 フィールドで、「**応答**」を入力します。
       
    1.  「**アクション**」 一覧で、「**応答**」 を選択します。

1.  **デザイナー**領域において、次の手順で**応答アクション**を追加します。

    1.  「**状態コード**」ボックスに、**200**と入力します。

    1.  「**本文**」 フィールドの **動的なコンテンツ** の **選択(Output)** カテゴリで、**出力(Select)** します。

1.  **デザイナー** 領域で、**保存** を選択します。

#### レビュー

この演習では、HTTP GET 要求によってトリガーされたときに開始される基本的なワークフローを作成しました。次に、ストレージ サービスを照会し、結果を列挙し、その結果を HTTP 応答として返します。

### エクササイズ 3: Azure API Management をロジック アプリのプロキシとして使用する

#### タスク 1: 新しいブランチを作成する

1.  Azure portal の左側のナビゲーション ウィンドウで、**リソース グループ** を選択します。

1.  **リソース グループ** ブレードで、この実習ラボで前に作成した **AutomatedWorkflow** リソース グループを選択します。

1.  「**AutomatedWorkflow**」 ブレードで、 この実習ラボで前に作成した **prodapim*[yourname]*** の API Management サービスを選択します。

1.  **API Management サービス** ブレードの **API Management** セクションで **製品** を選択します。

1.  **製品** セクションで、**+ 追加** を選択します。

1.  **製品の追加** ダイアログ ボックスで、次の手順を実行します：

    1.  「**表示名**」 ボックスに、「**Free**」 を入力します。

    1.  「**ID**」 テキストボックスに、「**free**」 を入力します。

    1.  「**説明**」 テキストボックスに、「**匿名使用の無料階層**」 を入力します。

    1.  「**状態**」 セクションで、「**発行済み**」 を選択します。

    1.  「**サブスクリプションを要求する**」 チェック ボックスがオフになっていることを確認します。

    1.  「**作成**」 を選択します。

#### タスク 2：Logic Apps と統合された API を作成する

1.  **API Management サービス** ブレードの **API Management** セクションから **API** を選択します。

1.  **Add a new API** セクションで、**Logic App** を選択します。

1.  **ロジック アプリからの作成(Create from Logic App)** ブレードで、次の操作を実行します。

    1.  **すべて(フル)** を選択します。

    1.  **ロジック アプリ(Logic App)** セクションで、**参照(Browse)** を選択します。 
    
    1.  「**インポートするロジック アプリの選択**」 ダイアログ ボックスで、このラボで前に作成した **prodflow*[yourname]*** ロジック アプリを選択し、「**選択**」 をクリックします。
    
    1.  **表示名(Display name)** ボックスに、**Metadata Lookup**を入力します。
    
    1.  「**名前**」 ボックスに、**metadata-lookup** を入力します。

    1.  「**説明**」 ボックスに、「**メタデータ JSON ファイルの検索**」 と入力します。

    1.  **API URL suffix** ボックスを空のままにします。

    1.  **製品(Products)** リストで **Free** を選択します。

    1.  「**作成**」 を選択します。 

    > **注**: 新しい API の作成が完了するのを待ちます。

#### タスク 3: API 操作をテストする

1.  **デザイン** タブで、**Test** を選択します。

1.  **Test**タブで、次の操作を実行します：

    1.  単一の **GET** 操作を選択 します。

    1.  **Request URL** フィールドの値をコピーします。（これらの値は、この演習の後半で使用します）

    1.  **[送信(Send)]** をクリックします。

    1.  **HTTP レスポンス(HTTP response)** セクションで、テスト要求の JSON 結果を確認します。

#### タスク 4: httprepl を使用してエンドツーエンドのソリューションを検証する

1.  タスク バーで、**Windows Terminal** アイコンを選択します。

1.  開いているコマンド プロンプトで次のコマンドを入力し、Enter を選択して **httprepl** ツールを起動します。この演習ラボで先ほどコピーした API 操作の **要求 URL** の値をベース URI に設定します。

    ```
    httprepl <api-operation-request-url>
    ```

    > **注**: たとえば **URL** が **https://prodapimstudent.azure-api.net/manual/paths/invoke** の場合 、コマンドは **httprepl https://prodapimstudent.azure-api.net/manual/paths/invoke** になります。

1.  ツール プロンプトで次のコマンドを入力し、Enter を選択してAPI エンドポイントに対して **get** コマンドを実行します。

    ```
    get
    ```

1.  関数アプリから JSON 応答の内容を確認します。

    ```
    [ 
        "item_00.json",
        "item_01.json",
        "item_02.json",
        "item_03.json",
        "item_04.json"
    ]
    ```

1.  次のコマンドを入力してから、Enter を選択して **httprepl** アプリケーションを終了します。

    ```
    exit
    ```

1.  現在実行中の Windows Terminal アプリケーションを閉じます。

1.	Azure portal のブラウザー ウインドウに戻ります。

#### レビュー

この演習では、Azure API Management をプロキシとして使用して、ロジック アプリ のワークフローをトリガーしました。

### 演習 4: サブスクリプションのクリーンアップ 

#### タスク 1: Azure Cloud Shell を開き、リソース グループを一覧表示する

1.  Azure portal で、「**Cloud Shell**」 アイコンを選択し、新しいシェル インスタンスを開きます。

1.  Azure portal  の **Cloud Shell** コマンド プロンプトで、次のコマンドを入力してから、Enter を選択してサブスクリプション内のすべてのリソース グループを一覧表示します。

    ```
    az group list
    ```

1.  次のコマンドを入力し、Enter キーを押して、リソース グループを削除可能なコマンドの一覧を表示します。

    ```
    az group delete --help
    ```

#### タスク 2: リソース グループを削除する

1.  次のコマンドを入力し、Enter キーを押して **AutomatedWorkflow** リソース グループを削除します。

    ```
    az group delete --name AutomatedWorkflow --no-wait --yes
    ```

1.  Cloud Shell パネルを閉じます。

#### タスク 3: アクティブなアプリケーションを閉じる

-   現在実行中の Microsoft Edge アプリケーションを閉じます。

#### レビュー

この実習では、この課題で使用するリソース グループを削除することで、サブスクリプションをクリーンアップしました。